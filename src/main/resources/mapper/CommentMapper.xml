<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcomputerstudy1.example.mapper.CommentMapper">

	<!--  Result Map 선언 -->
	
	<resultMap type="User" id="User">
			<result column="u_idx" property="uIdx"/>
			<result column="u_id" property="username"/>
			<result column="u_name" property="uName"/>
	</resultMap>
	
	<resultMap type="Comment" id="commentResultMap">
		<result column="c_idx" property="cIdx"/>
		<result column="c_content" property="cContent"/>
		<result column="c_datetime" property="cDatetime"/>
		<association  property="user" resultMap="User"/>
	</resultMap>



	<!-- 댓글 수  -->
	<select id="commentCount" resultType="int">
    	 SELECT			 COUNT(*) count 
    	 FROM 				lc_comment
	</select> 
	
		<!-- 댓글 리스트  -->
	<select id="selectCommentList" parameterType="Commnet" resultMap="CommentResultMap" >
	  	      
	      SELECT                   @ROWNUM := @ROWNUM -1 AS ROWNUM,
	                     ta.*, tb.u_id, tb.u_name, tb.u_idx
				                 
		  FROM	                 lc_comment ta
			  
		  LEFT JOIN 		     lc_user tb ON ta.u_idx = tb.u_idx, 
	               		 (SELECT @rownum := (SELECT COUNT(*)-#{pageNum}+1 FROM lc_comment ta))tc
	      WHERE			   b_id = #{bId}         		 
 		  ORDER BY         b_group desc, b_order asc
		  LIMIT	          		 #{pageNum},5

	   </select>

</mapper>