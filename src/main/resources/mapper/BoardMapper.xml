<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcomputerstudy1.example.mapper.BoardMapper">
	
	<!-- sql code 조각  -->
	<sql id="Search">
	<where>
		<if test="search != null and  search.type !=''">
			<if test="search.type == 1"> b_title LIKE CONCAT('%',#{search.keyword},'%')</if>
			<if test="search.type == 2">AND b_content LIKE CONCAT('%', #{search.keyword} ,'%')</if>
			<if test="search.type == 3">AND b_title LIKE CONCAT('%',#{search.keyword},'%') OR b_content LIKE CONCAT('%', #{search.keyword} ,'%')</if>
			<if test="search.type == 4">AND b_writer LIKE CONCAT('%' , #{search.keyword} ,'%')</if>
		</if>
	</where>
	</sql>


	<!-- 게시판 리스트  -->
	<select id="selectBoardList" resultType="Board">
	  	      
	      SELECT                   @ROWNUM := @ROWNUM -1 AS ROWNUM,
	                     ta.b_id as bId,
				                 ta.b_title as bTitle,
				                 ta.b_content as bContent,
				                 ta.b_writer as bWriter,
				                 ta.b_datetime as bDatetime,
				                 ta.b_viewcount as bViewcount,
				                 tb.u_id,
				                 tb.u_name,
				                 tb.u_idx
				                 
		  FROM	                 lc_board ta
			  
		  LEFT JOIN 		     lc_user tb ON ta.u_idx = tb.u_idx, 
	               		 (SELECT @rownum := (SELECT COUNT(*)-#{pageNum}+1 FROM lc_board ta))tc
 		 <include refid="Search"></include> 
 		  ORDER BY				bId desc	 
		  LIMIT	          		 #{pageNum},5

		       		

	   </select>


	<!-- 게시글 수  -->
	<select id="boardCount" resultType="int">
    	 SELECT			 COUNT(*) count 
    	 FROM 				lc_board
	  	<include refid="Search"></include>
	</select> 



	<!-- 게시판 상세보기  -->
	<select id="boardDetail" resultType="Board" parameterType="Board">
		select
					 	  ta.b_id as bId,
			              ta.b_title as bTitle,
			              ta.b_content as bContent,
			              ta.b_writer as bWriter,
			              ta.b_datetime as bDatetime,
			              ta.b_viewcount as bViewcount,
			              tb.u_id as username,
			              tb.u_name as uName,
			              tb.u_idx as uIdx
		from lc_board ta 
		left join lc_user tb on ta.u_idx= tb.u_idx 
		where b_id=#{bId}	  	      

	  </select>



	<!-- 게시판 등록하기  -->
	<select id="insertProcess" resultType="Board" parameterType="Board">
	  	      
	insert into lc_board( b_title, b_content, b_writer, b_viewcount ,u_idx)
	 VALUES(#{bTitle}, #{bContent}, #{bWriter}, #{bViewcount}, #{uIdx} )
	
	
	</select>
	
	
	<!-- 게시판 불러오기  -->
	<select id="editBoard" resultType="Board" parameterType="Board">
		select
					 	  b_id as bId,
			              b_title as bTitle,
			              b_content as bContent,
			              b_writer as bWriter,
			              b_datetime as bDatetime,
			              b_viewcount as bViewcount
			              
		from lc_board 
		where b_id=#{bId}	  	      

	  </select>

	<!-- 게시판 수정작업  -->
	<select id="editProcessBoard" resultType="Board" parameterType="Board">
		UPDATE lc_board 
		SET b_title = #{bTitle} , b_content = #{bContent} , b_datetime = now()
		WHERE b_id = #{bId}
			  	      

	  </select>
	  
	  
	  
	<!-- 게시판 삭제하기  -->
	<select id="boardDelete" resultType="Board" parameterType="Board">
		DELETE from lc_board 
		WHERE b_id = #{bId}

	  </select>

	<!-- 게시판 조회수 증가  -->
	<select id="boardViewCount" resultType="Board" parameterType="Board">
		UPDATE lc_board SET b_viewcount = b_viewcount+1  
		WHERE b_id = #{bId}

	  </select>

</mapper>