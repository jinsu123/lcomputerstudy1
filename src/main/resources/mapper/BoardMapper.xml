<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcomputerstudy1.example.mapper.BoardMapper">
	
	<!-- sql code 조각  -->
	<sql id="search">
	<where>
		<if test="type != null">
			<if test="type == '1'">AND TITLE LIKE '%'|| #{keyword} || '%'</if>
			<if test="type == '2'">AND CONTENT LIKE '%' || #{keyword} || '%'</if>
			<if test="type == '3'">AND (TITLE LIKE '%' || #{keyword} || '%') OR (CONTENT LIKE '%' || #{keyword} || '%')</if>
			<if test="type == '4'">AND WRITER LIKE '%' || #{keyword} || '%'</if>
		</if>
	</where>
	</sql>


	<!-- 게시판 리스트  -->
	<select id="selectBoardList" resultType="Board">
	  	      
	      SELECT                   @ROWNUM := @ROWNUM -1 AS ROWNUM,
	                     ta.b_id as bId,
				                 ta.b_title as bTitle,
				                 ta.b_content as bContent,
				                 ta.b_writer as bWriter,
				                 ta.b_datetime as bDatetime,
				                 ta.b_viewcount as bViewcount,
				                 tb.u_id,
				                 tb.u_name
				                 
		  FROM	                 lc_board ta
			  
		  LEFT JOIN 		     lc_user tb ON ta.u_idx = tb.u_idx, 
	               		 (SELECT @rownum := (SELECT COUNT(*)-#{pageNum}+1 FROM lc_board ta))tc
 			 
		  LIMIT	          		 #{pageNum},5

		       		

	   </select>


	<!-- 게시글 수  -->
	<select id="boardCount" resultType="int">
    	 SELECT			 COUNT(*) count 
    	 FROM 				lc_board
   	 	<!-- WHERE절을 include 태그로 삽입  -->
		<include refid="search"></include>    	 
	</select> 



	<!-- 게시판 상세보기  -->
	<select id="boardDetail" resultType="Board" parameterType="Board">
		select * ,
					ta.b_id as bId,
									                 ta.b_title as bTitle,
									                 ta.b_content as bContent,
									                 ta.b_writer as bWriter,
									                 ta.b_datetime as bDatetime,
									                 ta.b_viewcount as bViewcount,
									                 tb.u_id,
									                 tb.u_name
		from lc_board ta 
		left join lc_user tb on ta.u_idx= tb.u_idx 
		where b_id=#{bId}	  	      

	   </select>


	



</mapper>